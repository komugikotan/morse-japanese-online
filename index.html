<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>和文モールス　送信練習</title>
    <script>
        var date = new Date();

        var start_sec = date.getSeconds(); // ミリ秒(0～999)
        var stop_sec = date.getSeconds(); // ミリ秒(0～999)

        document.addEventListener('keydown', keypress_event);
        document.addEventListener('keyup', keyup_event);

        let status = null;
        let current_second = null;
        var morse = null;

        // タイマーの開始時刻を保持する変数
        let startTime = null;

        // タイマーの経過時間を保持する変数
        let elapsedTime = 0;

        // タイマーの開始関数
        function startTimer() {
            // 開始時刻を現在の時刻に設定
            startTime = Date.now();
        }

        // タイマーの終了関数
        function endTimer() {
            // 経過時間を保持する変数（ローカル）
            let elapsedTime = 0;
            // 経過時間を計算
            elapsedTime = Date.now() - startTime;
            // 経過時間をミリ秒単位で返す
            return elapsedTime;
        }


        function keypress_event(e) {
            if (status == 0){
                if (current_second > 0.25){
                    morse = morse + "-";
                    console.log(morse);
                }
                else if (current_second < 0.25){
                    morse = morse + ".";
                    console.log(morse);
                }
                else if (current_second > 0.7){
                    morse = morse + " ";
                    console.log(morse);
                }
            }

            if(e.key === ' ' || e.key === ' '){
                //スペースキーが押された時の処理
                if (status != 1){
                    startTimer();
                    status = 1;
                    console.log("pressed");
                }
                else{

                }
                
            }
            return false; 
        }

        function keyup_event(e) {
            if(e.key === ' ' || e.key === ' '){
                //スペースキーが押された時の処理
                if (status == 1){
                    status = 0;
                    current_second = endTimer() / 1000;
                    console.log(current_second);
                }
                else{

                }
            }
            return false; 
        }
    </script>
</head>
<body>
    <p id="output"></p>
</body>
</html>